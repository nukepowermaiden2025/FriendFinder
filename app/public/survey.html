<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Friend Survey </title>

  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</head>
<body>

  <div class="container">

    <div class="jumbotron">
      <h1 class="text-center"><span class="glyphicon glyphicon-transfer"></span>Friend Finder</h1>
      <hr>
      <h2 class="text-center">Find your somebody</h2>
      <br>

      <div class="text-center">
        <a href="/tables"><button class="btn btn-lg btn-primary"><span class="glyphicon glyphicon-list-alt"></span> View Matches </button></a>
        <a href="/"><button class="btn btn-lg btn-default"><span class="glyphicon glyphicon-home"></span></button></a>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">

        <!-- Survey Page -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Friend Compatability Survey</h3>
          </div>
          <div class="panel-body">

            <form role="form">
                <div  class="question-section">
                <div class="form-group">
                    <label for="friend-name">Name</label>
                    <input type="text" class="form-control" id="friend-name">
                </div>

                <div class="form-group">
                    <label for="friend-photo">Photo Link</label>
                    <input type="text" class="form-control" id="friend-photo">
                    <hr>
                </div>
                </div>

              <button type="submit" class="btn btn-primary submit">Submit</button>
            </form>

          </div>
        </div>

      </div>
    </div>


    <footer class="footer">
      <div class="container">
        <p><a href="/api/friendsData">API Friends Link</a> | <a href="https://github.com/nukepowermaiden2025/FriendFinder">GitHub Repo</a></p>
      </div>
    </footer>

  </div>

</body>
</html>

<script type="text/javascript">
//Rendering questions to the page dynamically
 var questions = [
        "How often do you cook meals at home?",
        "How often do you do laundry?",
        "How often do you use public transportation rather than driving?",
        "How often do you go to sporting events or concerts?",
        "How often do you read non-fiction books or informative articles?",
        "How often do you take vacations?",
        "How often do you party with your friends?",
        "How often do you or would you like to volunteer?",
        "How often do you use social media?",
        "How often do you expect see your new friend?",        
    ];

    for(var i=0;i< questions.length; i++){
        $(".question-section").append(`
        <form role="form"> 
            <h4><label for="friendq">${questions[i]}</label></h4>
            <div class="form-check form-check-inline friendq">
                <div>With 1 being least often and 5 being most often</div>
                <label class="form-check-label">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="1"> 1
                </label>
                <label class="form-check-label">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="2"> 2
                </label>
                <label class="form-check-label">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="3"> 3
                </label>
                <label class="form-check-label">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio4" value="4"> 4
                </label>
                <label class="form-check-label">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio5" value="5"> 5
                </label>
                <br>
            </div>                     
        </form><hr>`
        );
    };
</script>

<!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">

    // In this code below we create the Front-end JavaScript which "POSTS" our form data to our express server.
    // In essence, when the user hits submit, jQuery grabs all of the fields then sends a post request to our api
    // Our api recognizes the route (/api/tables)... and then runs the associated code (found in api-routes.js).
    // In this case the associated code "saves" the data to the table-data.js file or waitinglist-data.js file

    $(".submit").on("click", function(event) {
      event.preventDefault();

        function target(targetDiv){
            var scores =[]; 
            targetDiv.each(function() {
                scores.push($( this ).val());
            });
            return scores;
        };

      // Here we grab the form elements
      var newFriend = {
        name: $("#friend-name").val().trim(),
        photo: $("#friend-photo").val().trim(),
        scores: target($('.friendq label.active input'))
      };

      console.log(newFriend);

      // This line is the magic. It"s very similar to the standard ajax function we used.
      // Essentially we give it a URL, we give it the object we want to send, then we have a "callback".
      // The callback is the response of the server. In our case, we set up code in api-routes that "returns" true or false
      // depending on if a tables is available or not.

      $.post("/api/friends", newFriend,
        function(data) {

          // If there is a match tell the user they are lucky
          if (data) {
            alert("Yay! You have officially put yourself out there to meet people!");
          }

          // If there is not a match tell the user they are unlucky
          else {
            alert("Sorry you are unlucky today");
          }

        //   // Clear the form when submitting
        //   $("#friend-name").val("");
        //   $("#friend-photo").val("");
        //   $(".friendq1").val("");

        });

    });

</script>
